
в процессе...

## ReactJS: получаем ифформацию из OMDB API с помощью Axios

Axios по праву считается самой популярной библиотектой для HTTP-запросов среди React разработчиков, благодаря простоте ее использования и наличию большого количества "фишек", которых нет в "нативном fetch"(*или же реализуются через "костыли"*).

### Установка и настройка

> **ВНИМАНИЕ!** Перед тем как приступить к уроку, Вам понадобятся базовые знания по ReactJS.  

Для начала нам нужен стартовый шаблон для React. Я создал его с помощью утилиты - [**create-react-app**](https://github.com/facebook/create-react-app ). Он установит минимальный набор компонентов, который понадобится для нашего небольшого приложения. 
Также создал небольшую структуру компонентов.
```
src
  components 
   - Card.js       / карточка фильма
   - Content.js    / обертка для компонентов
   - Error.js      / компонент ошибки
   - Search.js     / компонент поиска
    
  App.js           / главный компонент
  settings.js      / настройки доступа к API
```
написал несколько стилей в `index.css` и установил Axios . Готовый шаблон можно скачать [**тут**](/lessons/film-app)

### API
[OMDB API](http://www.omdbapi.com/). Это открытая база фильмов. Здесь есть 2 оснвных вида запроса
- поиск по ID или названию фильма
- поиск по названию фильмов
Отличаются они тем, что первый метод вернет нам полную информацию об одном фильме, а второй - краткую информацию по нескольким, в которых присутствует: название фильма, постер, год создания, тип и уникальный номер в базе OMDB. 

Кроме того, можно уточнить найденные данные по: году выпуска, типу(сериал, полнометражка, короткометражка), типу выходных данных (JSON или XML), расширенной или короткой аннотации и номеру страницы. При поиске всех соответствий в базе(_когда выдаюьсмя множество результатов поиска_) указывается общее количество найденных фильмов. Выдача идет постранично(_по 10 фильмов на странице_), и можно указать какую из страниц вы хотите получить.

Для того чтобы иметь доступ к базе, нужно получить API key. Зарегистрировать его можно здесь - http://www.omdbapi.com/apikey.aspx 

В бесплатной версии количество запросов лимитировано(1000 в день). 1$ в месяц стоит 100 000 запросов, а за 5$ вы получите доступ к Poster API - сервису, который предоставляет постеры к фильмам в высоком разрешении. Со всеми тарифами можно ознакомиться на их странице в [Patreon](https://www.patreon.com/bePatron?u=5038490)

### Настройка доступа
В файле **settings.js** напишем следующий код. Вместо *'your api key..'* вы вставляете ключ, полученный при регистрации.
```js
const api = {
  OMDB_KEY: 'your api key...',
  get OMDB_PATH() {
      return `http://www.omdbapi.com/?apikey=${this.OMDB_KEY}`
  }
}

export default api
```

### Пишем GET-запрос
Откроем файл `App.js`и напишем нащ запрос к базе данных в методе `searchFilms()`
```js
searchFilms(title) {    
  axios.get(`${api.OMDB_PATH}&s=${title}`)
    .then((response) => {
    
      // посмотрим что приходит в ответе от сервера
      console.log('RESPONSE->', response) 
      
      let status = (response.data.Response.toLowerCase() === 'true') ? true : false;
      this.setState({
          films: response.data.Search,
          status: status,
          err: response.data.Error
      }); 
    })
    .catch( error => console.log(error.message) )     
} 
```
Итак, мы вызываем метод GET у axios, и в качестве ссылки передаем туда шаблонную строку 
```
`${api.OMDB_PATH}&s=${title}`
```
- **api.OMDB_PATH** вернет ссылку для запроса `http://www.omdbapi.com/?apikey=${this.OMDB_KEY}`, где *OMDB_KEY* - ваш ключ к API
- **s=${title}** `s=`- парметр поиска, который вернет все найденные фильмы с заголовком `${title}`. Например s=Batman вернет все фильмы, в названии которых есть слово Batman

> Если указать параметр `t=`, то поиск будет идти строго по названию фильма, и выдаст единственный результат, который соответствует введенной строке `${title}`

Не забудем пробросить метод searchFilms в constructor у компонента `App`, чтобы его контекст не потерялся
```js
constructor(props) {
  super(props)

  this.state = {
    films: [],
    status: true,
    err: 'no errors...'
  }

  this.searchFilm = this.searchFilm.bind(this);
}
```
- **films** наш итоговый массив с фильмами
- **status** статус ответа от сервера, true - все хорошо и данные пришли, false - ошибка
- **err** текст ошибки, которая вернется в случае status=false
- **searchFilm** собственно сам метод поиска фильмов

### Вывод

Готовый проект можно скачать в папке [**film-app**](/lessons/film-app)
